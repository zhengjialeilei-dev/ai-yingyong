<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¢ç§¯ä¸€å®šï¼Œè°çš„å‘¨é•¿æœ€å¤§ï¼Ÿ - æ•°å­¦æ¢ç©¶</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0f1a;
            --bg-secondary: #111827;
            --bg-card: #1a2234;
            --accent-cyan: #22d3ee;
            --accent-orange: #fb923c;
            --accent-pink: #f472b6;
            --accent-green: #4ade80;
            --accent-purple: #a78bfa;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border-color: #334155;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans SC', 'Outfit', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* èƒŒæ™¯è£…é¥° */
        .bg-decoration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .bg-decoration::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(ellipse at 20% 20%, rgba(34, 211, 238, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(251, 146, 60, 0.06) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(167, 139, 250, 0.04) 0%, transparent 60%);
            animation: bgFloat 30s ease-in-out infinite;
        }

        @keyframes bgFloat {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(2%, 2%) rotate(2deg); }
            66% { transform: translate(-1%, 1%) rotate(-1deg); }
        }

        /* ç½‘æ ¼èƒŒæ™¯ */
        .grid-pattern {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(51, 65, 85, 0.3) 1px, transparent 1px),
                linear-gradient(90deg, rgba(51, 65, 85, 0.3) 1px, transparent 1px);
            background-size: 40px 40px;
            pointer-events: none;
            z-index: 0;
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* æ ‡é¢˜åŒºåŸŸ */
        header {
            text-align: center;
            margin-bottom: 3rem;
            animation: fadeInDown 0.8s ease-out;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            font-size: 2.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-cyan) 0%, var(--accent-purple) 50%, var(--accent-orange) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
        }

        .subtitle {
            font-size: 1.2rem;
            color: var(--text-secondary);
            font-weight: 300;
        }

        /* ä¸»è¦å¸ƒå±€ */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 2rem;
            animation: fadeIn 1s ease-out 0.3s both;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* å¯è§†åŒ–åŒºåŸŸ */
        .visualization-area {
            background: var(--bg-card);
            border-radius: 24px;
            border: 1px solid var(--border-color);
            padding: 2rem;
            position: relative;
            overflow: hidden;
        }

        .visualization-area::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-cyan), var(--accent-purple), var(--accent-orange));
        }

        .canvas-container {
            width: 100%;
            aspect-ratio: 4/3;
            position: relative;
            background: var(--bg-secondary);
            border-radius: 16px;
            overflow: hidden;
        }

        #mainCanvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        /* æ§åˆ¶é¢æ¿ */
        .control-panel {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .panel-card {
            background: var(--bg-card);
            border-radius: 20px;
            border: 1px solid var(--border-color);
            padding: 1.5rem;
            position: relative;
            overflow: hidden;
        }

        .panel-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--accent-cyan), transparent);
        }

        .panel-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .panel-title svg {
            width: 20px;
            height: 20px;
            color: var(--accent-cyan);
        }

        /* æ»‘å—æ ·å¼ */
        .slider-group {
            margin-bottom: 1.2rem;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .slider-label span {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .slider-value {
            font-family: 'Outfit', monospace;
            font-weight: 600;
            color: var(--accent-cyan);
            font-size: 1rem;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            appearance: none;
            background: var(--bg-secondary);
            border-radius: 10px;
            outline: none;
            cursor: pointer;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 22px;
            height: 22px;
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(34, 211, 238, 0.4);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(34, 211, 238, 0.5);
        }

        input[type="range"]::-moz-range-thumb {
            width: 22px;
            height: 22px;
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
            border-radius: 50%;
            cursor: pointer;
            border: none;
            box-shadow: 0 4px 12px rgba(34, 211, 238, 0.4);
        }

        /* å½¢çŠ¶é€‰æ‹© */
        .shape-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.8rem;
        }

        .shape-btn {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 1rem 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }

        .shape-btn:hover {
            border-color: var(--accent-cyan);
            background: rgba(34, 211, 238, 0.1);
        }

        .shape-btn.active {
            border-color: var(--accent-cyan);
            background: rgba(34, 211, 238, 0.15);
            box-shadow: 0 0 20px rgba(34, 211, 238, 0.2);
        }

        .shape-btn svg {
            width: 32px;
            height: 32px;
        }

        .shape-btn span {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .shape-btn.active span {
            color: var(--accent-cyan);
            font-weight: 500;
        }

        /* æ•°æ®å±•ç¤º */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .stat-item {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.3rem;
        }

        .stat-value {
            font-family: 'Outfit', monospace;
            font-size: 1.4rem;
            font-weight: 700;
        }

        .stat-value.area {
            color: var(--accent-orange);
        }

        .stat-value.perimeter {
            color: var(--accent-green);
        }

        /* æ’è¡Œæ¦œ */
        .ranking-list {
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
        }

        .ranking-item {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            padding: 0.8rem 1rem;
            background: var(--bg-secondary);
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .ranking-item:hover {
            background: rgba(34, 211, 238, 0.1);
        }

        .rank-number {
            width: 28px;
            height: 28px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85rem;
            flex-shrink: 0;
        }

        .rank-1 { background: linear-gradient(135deg, #fbbf24, #f59e0b); color: #1a1a1a; }
        .rank-2 { background: linear-gradient(135deg, #94a3b8, #64748b); color: #1a1a1a; }
        .rank-3 { background: linear-gradient(135deg, #cd7f32, #b8860b); color: #1a1a1a; }
        .rank-other { background: var(--bg-card); color: var(--text-secondary); }

        .rank-shape {
            flex: 1;
            font-size: 0.9rem;
            color: var(--text-primary);
        }

        .rank-perimeter {
            font-family: 'Outfit', monospace;
            font-weight: 600;
            color: var(--accent-green);
            font-size: 0.95rem;
        }

        /* çŸ¥è¯†å¡ç‰‡ */
        .knowledge-card {
            background: linear-gradient(135deg, rgba(167, 139, 250, 0.1), rgba(34, 211, 238, 0.1));
            border: 1px solid rgba(167, 139, 250, 0.3);
            border-radius: 16px;
            padding: 1.2rem;
            margin-top: 1rem;
        }

        .knowledge-card h4 {
            color: var(--accent-purple);
            font-size: 0.95rem;
            margin-bottom: 0.6rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .knowledge-card p {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .highlight {
            color: var(--accent-cyan);
            font-weight: 500;
        }

        /* é•¿æ–¹å½¢è°ƒèŠ‚å™¨ */
        .rectangle-adjuster {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }

        .adjuster-hint {
            font-size: 0.8rem;
            color: var(--text-muted);
            text-align: center;
            margin-bottom: 0.8rem;
        }

        /* åŠ¨ç”»æ¯”è¾ƒ */
        .compare-btn {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
            border: none;
            border-radius: 12px;
            color: var(--bg-primary);
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .compare-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(34, 211, 238, 0.3);
        }

        .compare-btn svg {
            width: 20px;
            height: 20px;
        }

        /* å“åº”å¼ */
        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .control-panel {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
            }

            h1 {
                font-size: 2rem;
            }
        }

        @media (max-width: 640px) {
            .container {
                padding: 1rem;
            }

            .control-panel {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 1.6rem;
            }

            .shape-selector {
                grid-template-columns: repeat(4, 1fr);
            }

            .shape-btn {
                padding: 0.8rem 0.5rem;
            }

            .shape-btn svg {
                width: 24px;
                height: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="bg-decoration"></div>
    <div class="grid-pattern"></div>

    <div class="container">
        <header>
            <h1>ğŸ”· é¢ç§¯ä¸€å®šï¼Œè°çš„å‘¨é•¿æœ€å¤§ï¼Ÿ</h1>
            <p class="subtitle">æ¢ç©¶ç­‰é¢ç§¯å›¾å½¢çš„å‘¨é•¿å¥¥ç§˜ â€” äº¤äº’å¼æ•°å­¦å®éªŒå®¤</p>
        </header>

        <div class="main-content">
            <div class="visualization-area">
                <div class="canvas-container">
                    <canvas id="mainCanvas"></canvas>
                </div>
            </div>

            <div class="control-panel">
                <!-- é¢ç§¯æ§åˆ¶ -->
                <div class="panel-card">
                    <div class="panel-title">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2"/>
                            <path d="M3 9h18M9 3v18"/>
                        </svg>
                        å›ºå®šé¢ç§¯
                    </div>
                    <div class="slider-group">
                        <div class="slider-label">
                            <span>è°ƒæ•´é¢ç§¯å¤§å°</span>
                            <span class="slider-value" id="areaValue">100 cmÂ²</span>
                        </div>
                        <input type="range" id="areaSlider" min="50" max="200" value="100" step="10">
                    </div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-label">å½“å‰é¢ç§¯</div>
                            <div class="stat-value area" id="currentArea">100</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">å½“å‰å‘¨é•¿</div>
                            <div class="stat-value perimeter" id="currentPerimeter">--</div>
                        </div>
                    </div>
                </div>

                <!-- å½¢çŠ¶é€‰æ‹© -->
                <div class="panel-card">
                    <div class="panel-title">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="12 2 22 20 2 20"/>
                        </svg>
                        é€‰æ‹©å½¢çŠ¶
                    </div>
                    <div class="shape-selector">
                        <button class="shape-btn active" data-shape="circle">
                            <svg viewBox="0 0 40 40" fill="none" stroke="var(--accent-cyan)" stroke-width="2">
                                <circle cx="20" cy="20" r="14"/>
                            </svg>
                            <span>åœ†å½¢</span>
                        </button>
                        <button class="shape-btn" data-shape="square">
                            <svg viewBox="0 0 40 40" fill="none" stroke="var(--accent-orange)" stroke-width="2">
                                <rect x="6" y="6" width="28" height="28"/>
                            </svg>
                            <span>æ­£æ–¹å½¢</span>
                        </button>
                        <button class="shape-btn" data-shape="rectangle">
                            <svg viewBox="0 0 40 40" fill="none" stroke="var(--accent-green)" stroke-width="2">
                                <rect x="4" y="10" width="32" height="20"/>
                            </svg>
                            <span>é•¿æ–¹å½¢</span>
                        </button>
                        <button class="shape-btn" data-shape="triangle">
                            <svg viewBox="0 0 40 40" fill="none" stroke="var(--accent-pink)" stroke-width="2">
                                <polygon points="20,4 36,36 4,36"/>
                            </svg>
                            <span>ç­‰è¾¹ä¸‰è§’å½¢</span>
                        </button>
                        <button class="shape-btn" data-shape="hexagon">
                            <svg viewBox="0 0 40 40" fill="none" stroke="var(--accent-purple)" stroke-width="2">
                                <polygon points="20,3 35,11 35,29 20,37 5,29 5,11"/>
                            </svg>
                            <span>æ­£å…­è¾¹å½¢</span>
                        </button>
                        <button class="shape-btn" data-shape="thin-rect">
                            <svg viewBox="0 0 40 40" fill="none" stroke="#ef4444" stroke-width="2">
                                <rect x="2" y="15" width="36" height="10"/>
                            </svg>
                            <span>æ‰é•¿æ–¹å½¢</span>
                        </button>
                    </div>

                    <div class="rectangle-adjuster" id="rectAdjuster" style="display: none;">
                        <div class="adjuster-hint">ğŸ¯ æ‹–åŠ¨æ»‘å—æ”¹å˜é•¿å®½æ¯”</div>
                        <div class="slider-group">
                            <div class="slider-label">
                                <span>é•¿å®½æ¯”</span>
                                <span class="slider-value" id="ratioValue">2:1</span>
                            </div>
                            <input type="range" id="ratioSlider" min="1" max="20" value="2" step="0.5">
                        </div>
                    </div>
                </div>

                <!-- å‘¨é•¿æ’è¡Œæ¦œ -->
                <div class="panel-card">
                    <div class="panel-title">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M8 21h8M12 17v4M7 4h10l-1 8H8L7 4z"/>
                            <path d="M12 17a5 5 0 0 0 5-5H7a5 5 0 0 0 5 5z"/>
                        </svg>
                        å‘¨é•¿æ’è¡Œæ¦œï¼ˆåŒé¢ç§¯ï¼‰
                    </div>
                    <div class="ranking-list" id="rankingList">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </div>

                    <div class="knowledge-card">
                        <h4>ğŸ’¡ æ•°å­¦å‘ç°</h4>
                        <p>
                            é¢ç§¯ç›¸åŒæ—¶ï¼Œ<span class="highlight">åœ†å½¢çš„å‘¨é•¿æœ€å°</span>ï¼Œ
                            å½¢çŠ¶è¶Š"æ‰é•¿"æˆ–è¶Šä¸è§„åˆ™ï¼Œå‘¨é•¿è¶Šå¤§ã€‚
                            è¿™å°±æ˜¯ä¸ºä»€ä¹ˆèœ‚å·¢æ˜¯å…­è¾¹å½¢â€”â€”å®ƒèƒ½ç”¨æœ€å°‘çš„èœ¡å›´å‡ºæœ€å¤§çš„ç©ºé—´ï¼
                        </p>
                    </div>

                    <button class="compare-btn" id="compareBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M5 12h14M12 5l7 7-7 7"/>
                        </svg>
                        åŠ¨ç”»å¯¹æ¯”æ‰€æœ‰å½¢çŠ¶
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å¸¸é‡å’ŒçŠ¶æ€
        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');

        const state = {
            area: 100,
            currentShape: 'circle',
            rectangleRatio: 2,
            isAnimating: false,
            animationShapes: []
        };

        // é¢œè‰²é…ç½®
        const shapeColors = {
            circle: { stroke: '#22d3ee', fill: 'rgba(34, 211, 238, 0.2)', glow: 'rgba(34, 211, 238, 0.5)' },
            square: { stroke: '#fb923c', fill: 'rgba(251, 146, 60, 0.2)', glow: 'rgba(251, 146, 60, 0.5)' },
            rectangle: { stroke: '#4ade80', fill: 'rgba(74, 222, 128, 0.2)', glow: 'rgba(74, 222, 128, 0.5)' },
            triangle: { stroke: '#f472b6', fill: 'rgba(244, 114, 182, 0.2)', glow: 'rgba(244, 114, 182, 0.5)' },
            hexagon: { stroke: '#a78bfa', fill: 'rgba(167, 139, 250, 0.2)', glow: 'rgba(167, 139, 250, 0.5)' },
            'thin-rect': { stroke: '#ef4444', fill: 'rgba(239, 68, 68, 0.2)', glow: 'rgba(239, 68, 68, 0.5)' }
        };

        const shapeNames = {
            circle: 'åœ†å½¢',
            square: 'æ­£æ–¹å½¢',
            rectangle: 'é•¿æ–¹å½¢',
            triangle: 'ç­‰è¾¹ä¸‰è§’å½¢',
            hexagon: 'æ­£å…­è¾¹å½¢',
            'thin-rect': 'æ‰é•¿æ–¹å½¢'
        };

        // è®¡ç®—å‘¨é•¿çš„å‡½æ•°
        function calculatePerimeter(shape, area, ratio = 2) {
            switch (shape) {
                case 'circle':
                    // A = Ï€rÂ², P = 2Ï€r
                    const r = Math.sqrt(area / Math.PI);
                    return 2 * Math.PI * r;
                case 'square':
                    // A = sÂ², P = 4s
                    const s = Math.sqrt(area);
                    return 4 * s;
                case 'rectangle':
                case 'thin-rect':
                    // A = l*w, l = ratio*w, A = ratio*wÂ²
                    const actualRatio = shape === 'thin-rect' ? 10 : ratio;
                    const w = Math.sqrt(area / actualRatio);
                    const l = actualRatio * w;
                    return 2 * (l + w);
                case 'triangle':
                    // A = (âˆš3/4)sÂ², P = 3s
                    const side = Math.sqrt(4 * area / Math.sqrt(3));
                    return 3 * side;
                case 'hexagon':
                    // A = (3âˆš3/2)sÂ², P = 6s
                    const hexSide = Math.sqrt(2 * area / (3 * Math.sqrt(3)));
                    return 6 * hexSide;
                default:
                    return 0;
            }
        }

        // è®¾ç½®Canvaså¤§å°
        function resizeCanvas() {
            const container = canvas.parentElement;
            const dpr = window.devicePixelRatio || 1;
            canvas.width = container.clientWidth * dpr;
            canvas.height = container.clientHeight * dpr;
            ctx.scale(dpr, dpr);
            canvas.style.width = container.clientWidth + 'px';
            canvas.style.height = container.clientHeight + 'px';
            draw();
        }

        // ç»˜åˆ¶ç½‘æ ¼
        function drawGrid() {
            const w = canvas.width / (window.devicePixelRatio || 1);
            const h = canvas.height / (window.devicePixelRatio || 1);
            const gridSize = 30;

            ctx.strokeStyle = 'rgba(51, 65, 85, 0.4)';
            ctx.lineWidth = 0.5;

            for (let x = 0; x <= w; x += gridSize) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, h);
                ctx.stroke();
            }

            for (let y = 0; y <= h; y += gridSize) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(w, y);
                ctx.stroke();
            }
        }

        // ç»˜åˆ¶å½¢çŠ¶
        function drawShape(shape, cx, cy, area, ratio, highlight = false, scale = 1) {
            const colors = shapeColors[shape];
            const scaledArea = area * scale * scale;

            ctx.save();

            // å‘å…‰æ•ˆæœ
            if (highlight) {
                ctx.shadowColor = colors.glow;
                ctx.shadowBlur = 20;
            }

            ctx.strokeStyle = colors.stroke;
            ctx.fillStyle = colors.fill;
            ctx.lineWidth = highlight ? 3 : 2;

            ctx.beginPath();

            switch (shape) {
                case 'circle':
                    const r = Math.sqrt(scaledArea / Math.PI) * 3;
                    ctx.arc(cx, cy, r, 0, Math.PI * 2);
                    break;

                case 'square':
                    const s = Math.sqrt(scaledArea) * 3;
                    ctx.rect(cx - s / 2, cy - s / 2, s, s);
                    break;

                case 'rectangle':
                case 'thin-rect':
                    const actualRatio = shape === 'thin-rect' ? 10 : ratio;
                    const w = Math.sqrt(scaledArea / actualRatio) * 3;
                    const l = actualRatio * w;
                    ctx.rect(cx - l / 2, cy - w / 2, l, w);
                    break;

                case 'triangle':
                    const side = Math.sqrt(4 * scaledArea / Math.sqrt(3)) * 3;
                    const h = side * Math.sqrt(3) / 2;
                    ctx.moveTo(cx, cy - h * 2 / 3);
                    ctx.lineTo(cx - side / 2, cy + h / 3);
                    ctx.lineTo(cx + side / 2, cy + h / 3);
                    ctx.closePath();
                    break;

                case 'hexagon':
                    const hexSide = Math.sqrt(2 * scaledArea / (3 * Math.sqrt(3))) * 3;
                    for (let i = 0; i < 6; i++) {
                        const angle = Math.PI / 3 * i - Math.PI / 6;
                        const x = cx + hexSide * Math.cos(angle);
                        const y = cy + hexSide * Math.sin(angle);
                        if (i === 0) ctx.moveTo(x, y);
                        else ctx.lineTo(x, y);
                    }
                    ctx.closePath();
                    break;
            }

            ctx.fill();
            ctx.stroke();

            // ç»˜åˆ¶å‘¨é•¿æ ‡æ³¨
            if (highlight) {
                const perimeter = calculatePerimeter(shape, area, ratio);
                ctx.shadowBlur = 0;
                ctx.font = 'bold 16px Outfit, sans-serif';
                ctx.fillStyle = colors.stroke;
                ctx.textAlign = 'center';
                ctx.fillText(`å‘¨é•¿: ${perimeter.toFixed(2)} cm`, cx, cy + getShapeHeight(shape, area, ratio) / 2 + 30);
            }

            ctx.restore();
        }

        function getShapeHeight(shape, area, ratio) {
            switch (shape) {
                case 'circle':
                    return Math.sqrt(area / Math.PI) * 3 * 2;
                case 'square':
                    return Math.sqrt(area) * 3;
                case 'rectangle':
                    return Math.sqrt(area / ratio) * 3;
                case 'thin-rect':
                    return Math.sqrt(area / 10) * 3;
                case 'triangle':
                    const side = Math.sqrt(4 * area / Math.sqrt(3)) * 3;
                    return side * Math.sqrt(3) / 2;
                case 'hexagon':
                    return Math.sqrt(2 * area / (3 * Math.sqrt(3))) * 3 * 2;
                default:
                    return 50;
            }
        }

        // ä¸»ç»˜åˆ¶å‡½æ•°
        function draw() {
            const w = canvas.width / (window.devicePixelRatio || 1);
            const h = canvas.height / (window.devicePixelRatio || 1);

            ctx.clearRect(0, 0, w, h);
            drawGrid();

            if (state.isAnimating && state.animationShapes.length > 0) {
                // åŠ¨ç”»æ¨¡å¼ï¼šæ˜¾ç¤ºå¤šä¸ªå½¢çŠ¶
                const cols = 3;
                const rows = 2;
                const cellW = w / cols;
                const cellH = h / rows;

                state.animationShapes.forEach((item, i) => {
                    const col = i % cols;
                    const row = Math.floor(i / cols);
                    const cx = cellW * (col + 0.5);
                    const cy = cellH * (row + 0.5);

                    drawShape(item.shape, cx, cy, state.area, state.rectangleRatio, true, 0.6);

                    // å½¢çŠ¶åç§°
                    ctx.font = 'bold 14px Noto Sans SC, sans-serif';
                    ctx.fillStyle = shapeColors[item.shape].stroke;
                    ctx.textAlign = 'center';
                    ctx.fillText(shapeNames[item.shape], cx, cy - getShapeHeight(item.shape, state.area, state.rectangleRatio) * 0.3 - 25);
                });
            } else {
                // å•ä¸ªå½¢çŠ¶æ¨¡å¼
                drawShape(state.currentShape, w / 2, h / 2, state.area, state.rectangleRatio, true, 1);

                // æ˜¾ç¤ºå½¢çŠ¶åç§°
                ctx.font = 'bold 24px Noto Sans SC, sans-serif';
                ctx.fillStyle = shapeColors[state.currentShape].stroke;
                ctx.textAlign = 'center';
                ctx.fillText(shapeNames[state.currentShape], w / 2, 40);

                // æ˜¾ç¤ºé¢ç§¯
                ctx.font = '16px Outfit, sans-serif';
                ctx.fillStyle = '#fb923c';
                ctx.fillText(`é¢ç§¯ = ${state.area} cmÂ²`, w / 2, 70);
            }
        }

        // æ›´æ–°æ’è¡Œæ¦œ
        function updateRanking() {
            const shapes = ['circle', 'hexagon', 'square', 'triangle', 'rectangle', 'thin-rect'];
            const rankings = shapes.map(shape => ({
                shape,
                name: shapeNames[shape],
                perimeter: calculatePerimeter(shape, state.area, state.rectangleRatio)
            }));

            // æŒ‰å‘¨é•¿ä»å¤§åˆ°å°æ’åº
            rankings.sort((a, b) => b.perimeter - a.perimeter);

            const listEl = document.getElementById('rankingList');
            listEl.innerHTML = rankings.map((item, index) => `
                <div class="ranking-item">
                    <div class="rank-number ${index < 3 ? 'rank-' + (index + 1) : 'rank-other'}">${index + 1}</div>
                    <span class="rank-shape">${item.name}</span>
                    <span class="rank-perimeter">${item.perimeter.toFixed(2)} cm</span>
                </div>
            `).join('');
        }

        // æ›´æ–°å½“å‰å‘¨é•¿æ˜¾ç¤º
        function updateCurrentPerimeter() {
            const perimeter = calculatePerimeter(state.currentShape, state.area, state.rectangleRatio);
            document.getElementById('currentPerimeter').textContent = perimeter.toFixed(2);
            document.getElementById('currentArea').textContent = state.area;
        }

        // äº‹ä»¶ç›‘å¬
        document.getElementById('areaSlider').addEventListener('input', (e) => {
            state.area = parseInt(e.target.value);
            document.getElementById('areaValue').textContent = `${state.area} cmÂ²`;
            updateCurrentPerimeter();
            updateRanking();
            draw();
        });

        document.getElementById('ratioSlider').addEventListener('input', (e) => {
            state.rectangleRatio = parseFloat(e.target.value);
            document.getElementById('ratioValue').textContent = `${state.rectangleRatio}:1`;
            updateCurrentPerimeter();
            updateRanking();
            draw();
        });

        // å½¢çŠ¶é€‰æ‹©
        document.querySelectorAll('.shape-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.shape-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                state.currentShape = btn.dataset.shape;
                state.isAnimating = false;

                // æ˜¾ç¤º/éšè—é•¿æ–¹å½¢è°ƒèŠ‚å™¨
                const adjuster = document.getElementById('rectAdjuster');
                if (state.currentShape === 'rectangle') {
                    adjuster.style.display = 'block';
                } else {
                    adjuster.style.display = 'none';
                }

                updateCurrentPerimeter();
                draw();
            });
        });

        // åŠ¨ç”»æ¯”è¾ƒæŒ‰é’®
        document.getElementById('compareBtn').addEventListener('click', () => {
            state.isAnimating = true;
            state.animationShapes = [
                { shape: 'thin-rect' },
                { shape: 'rectangle' },
                { shape: 'triangle' },
                { shape: 'square' },
                { shape: 'hexagon' },
                { shape: 'circle' }
            ];
            draw();

            // 3ç§’åæ¢å¤å•å½¢çŠ¶æ¨¡å¼
            setTimeout(() => {
                state.isAnimating = false;
                draw();
            }, 5000);
        });

        // åˆå§‹åŒ–
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
        updateCurrentPerimeter();
        updateRanking();
    </script>
</body>
</html>

