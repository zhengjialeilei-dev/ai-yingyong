<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é•¿æ–¹ä½“åˆ‡å‰²æœ€å¤§æ­£æ–¹ä½“æ¼”ç¤º</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background-color: #f0f2f5; font-family: 'Segoe UI', sans-serif; }
        #canvas-container { width: 100vw; height: 100vh; display: block; }
        .overlay-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        .math-text { font-family: 'Times New Roman', serif; }
        
        /* Custom Range Slider */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            margin-top: -8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #cbd5e1;
            border-radius: 2px;
        }
        input[type=range].orange-slider::-webkit-slider-thumb {
            background: #f97316;
        }
        /* Style for disabled/invalid state */
        .text-invalid { color: #dc2626; font-weight: bold; }
    </style>
</head>
<body>

    <!-- UI Layer -->
    <div class="absolute top-4 left-4 z-10 max-w-md w-full p-4 pointer-events-none">
        <div class="overlay-card p-6 pointer-events-auto max-h-[90vh] overflow-y-auto">
            <h1 class="text-xl font-bold text-gray-800 mb-2">é•¿æ–¹ä½“åˆ‡æ­£æ–¹ä½“å®éªŒ</h1>
            <p class="text-sm text-gray-600 mb-4 leading-relaxed">
                é•¿æ–¹ä½“å°ºå¯¸ï¼š<span class="font-mono font-bold text-blue-600">5cm Ã— 4cm Ã— 3cm</span><br>
                <span class="text-xs text-gray-500">æç¤ºï¼šå°è¯•å°†æ£±é•¿è°ƒå¤§è¶…è¿‡ 3cmï¼Œè§‚å¯Ÿå‘ç”Ÿäº†ä»€ä¹ˆã€‚</span>
            </p>

            <!-- Controls -->
            <div class="space-y-6 mb-6">
                <!-- Size Slider -->
                <div>
                    <label class="flex justify-between text-sm font-semibold text-gray-700 mb-2">
                        <span>è®¾å®šæ­£æ–¹ä½“æ£±é•¿</span>
                        <span id="size-val" class="text-orange-600 font-mono">3.0 cm</span>
                    </label>
                    <!-- Changed max to 5.0 to allow exceeding dimensions -->
                    <input type="range" id="size-slider" min="0.1" max="5.0" step="0.1" value="3.0" class="w-full orange-slider">
                    <!-- Warning Message Container -->
                    <div id="limit-warning" class="hidden mt-2 p-2 bg-red-100 text-red-700 text-xs rounded border border-red-200 font-bold flex items-center">
                        <span class="mr-2 text-lg">âš ï¸</span> 
                        <span>è¶…å‡ºé•¿æ–¹ä½“é«˜åº¦(3cm)ï¼Œæ— æ³•åˆ‡å‰²ï¼</span>
                    </div>
                </div>

                <!-- Cut Progress Slider -->
                <div>
                    <label class="flex justify-between text-sm font-semibold text-gray-700 mb-2">
                        <span>åˆ‡å‰²/é€è§†è¿›åº¦</span>
                        <span id="progress-val">0%</span>
                    </label>
                    <input type="range" id="cut-slider" min="0" max="100" value="0" class="w-full">
                    <div class="flex justify-between text-xs text-gray-400 mt-1">
                        <span>æ˜¾ç¤ºåŸé•¿æ–¹ä½“</span>
                        <span>åªçœ‹æ­£æ–¹ä½“</span>
                    </div>
                </div>
            </div>

            <!-- Math Results -->
            <div class="space-y-2 text-sm border-t pt-4 relative">
                <div class="flex justify-between items-center">
                    <span class="text-gray-600">åŸä½“ç§¯ ($5 \times 4 \times 3$):</span>
                    <span class="font-mono font-bold text-blue-600">60 cmÂ³</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-gray-600">å½“å‰æ­£æ–¹ä½“ä½“ç§¯ ($a^3$):</span>
                    <span class="font-mono font-bold text-orange-500" id="math-cube-vol">27.00 cmÂ³</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-gray-600">å‡å°‘çš„ä½“ç§¯:</span>
                    <span class="font-mono font-bold text-gray-700" id="math-diff-vol">33.00 cmÂ³</span>
                </div>
                <div class="flex justify-between items-center bg-gray-100 p-2 rounded mt-2 transition-colors" id="result-box">
                    <span class="text-gray-800 font-semibold">ä½“ç§¯å‡å°‘ç™¾åˆ†æ¯”:</span>
                    <span class="font-mono font-bold text-green-600 text-lg" id="math-percent">55.00%</span>
                </div>
                <div class="text-xs text-gray-400 mt-1 text-right" id="math-formula">
                    (60 - 27) Ã· 60 â‰ˆ 0.55
                </div>
            </div>
        </div>
        
        <div class="mt-4 overlay-card p-3 text-xs text-gray-500 pointer-events-auto inline-block">
            ğŸ’¡ æç¤ºï¼šæ‹–åŠ¨ç¬¬ä¸€ä¸ªæ»‘å—æ”¹å˜å¤§å°ï¼Œè§‚å¯Ÿçº¢è‰²è­¦ç¤ºçŠ¶æ€ã€‚
        </div>
    </div>

    <!-- 3D Canvas -->
    <div id="canvas-container"></div>

    <script>
    (function() {
        // --- 3D Scene Setup ---
        const container = document.getElementById('canvas-container');
        
        while (container.firstChild) {
            container.removeChild(container.firstChild);
        }

        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xf0f2f5);
        scene.fog = new THREE.Fog(0xf0f2f5, 10, 50);

        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(10, 8, 12);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        container.appendChild(renderer.domElement);

        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;

        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);

        const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
        dirLight.position.set(5, 10, 7);
        dirLight.castShadow = true;
        scene.add(dirLight);

        // --- Geometry Constants ---
        const L = 5, W = 4, H = 3;
        const totalVol = L * W * H;

        const modelGroup = new THREE.Group();
        scene.add(modelGroup);

        // 1. Full Cuboid (Wireframe)
        const geometryTotal = new THREE.BoxGeometry(L, H, W);
        const materialTotalWire = new THREE.LineBasicMaterial({ color: 0x94a3b8, opacity: 0.3, transparent: true });
        const edgesTotal = new THREE.EdgesGeometry(geometryTotal);
        const wireframeTotal = new THREE.LineSegments(edgesTotal, materialTotalWire);
        wireframeTotal.position.set(L/2, H/2, W/2); 
        modelGroup.add(wireframeTotal);

        // 2. Waste Material (Blue Box)
        const materialWaste = new THREE.MeshStandardMaterial({
            color: 0x3b82f6,
            transparent: true,
            opacity: 0.3,
            roughness: 0.1,
            metalness: 0.1
        });
        const wasteMesh = new THREE.Mesh(geometryTotal, materialWaste);
        wasteMesh.position.set(L/2, H/2, W/2);
        modelGroup.add(wasteMesh);

        // 3. Inner Cube (Orange)
        // Use 1x1x1 geometry and scale it, easier for dynamic resizing
        const geometryCube = new THREE.BoxGeometry(1, 1, 1);
        const materialCube = new THREE.MeshStandardMaterial({
            color: 0xf97316, // Default Orange
            roughness: 0.2,
            metalness: 0.1
        });
        const cubeMesh = new THREE.Mesh(geometryCube, materialCube);
        modelGroup.add(cubeMesh);

        // 4. Edges for Cube
        const edgesCube = new THREE.EdgesGeometry(geometryCube);
        const lineCube = new THREE.LineSegments(edgesCube, new THREE.LineBasicMaterial({ color: 0x000000, linewidth: 2 }));
        modelGroup.add(lineCube);

        // Grid & Positioning
        const gridHelper = new THREE.GridHelper(20, 20, 0xcccccc, 0xe5e7eb);
        scene.add(gridHelper);
        modelGroup.position.set(-L/2, 0, -W/2);

        // --- Labels ---
        function createTextSprite(message, position) {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = 256;
            canvas.height = 128;
            context.font = 'Bold 40px Arial';
            context.fillStyle = 'rgba(0,0,0,1)';
            context.textAlign = 'center';
            context.fillText(message, 128, 80);
            const texture = new THREE.CanvasTexture(canvas);
            const sprite = new THREE.Sprite(new THREE.SpriteMaterial({ map: texture }));
            sprite.scale.set(2, 1, 1);
            sprite.position.copy(position);
            return sprite;
        }

        modelGroup.add(createTextSprite("é•¿ 5cm", new THREE.Vector3(L/2, -0.5, W + 0.5)));
        modelGroup.add(createTextSprite("å®½ 4cm", new THREE.Vector3(L + 0.5, -0.5, W/2)));
        modelGroup.add(createTextSprite("é«˜ 3cm", new THREE.Vector3(-0.5, H/2, W)));

        // --- Interaction Logic ---
        const sizeSlider = document.getElementById('size-slider');
        const sizeVal = document.getElementById('size-val');
        const cutSlider = document.getElementById('cut-slider');
        const progressVal = document.getElementById('progress-val');
        const limitWarning = document.getElementById('limit-warning');
        
        // Math DOM Elements
        const mathCubeVol = document.getElementById('math-cube-vol');
        const mathDiffVol = document.getElementById('math-diff-vol');
        const mathPercent = document.getElementById('math-percent');
        const mathFormula = document.getElementById('math-formula');
        const resultBox = document.getElementById('result-box');

        const LIMIT = Math.min(L, W, H); // 3

        function updateScene() {
            // 1. Handle Size Update
            const s = parseFloat(sizeSlider.value);
            sizeVal.innerText = s.toFixed(1) + " cm";

            // Update Cube Geometry (Scale & Position)
            cubeMesh.scale.set(s, s, s);
            lineCube.scale.set(s, s, s);
            const pos = s / 2;
            cubeMesh.position.set(pos, pos, pos);
            lineCube.position.set(pos, pos, pos);

            // 2. Logic Check: Does it fit?
            const isInvalid = s > LIMIT;
            
            if (isInvalid) {
                // Invalid State
                limitWarning.classList.remove('hidden');
                
                // Change cube color to Red to indicate error
                cubeMesh.material.color.setHex(0xdc2626); // Red
                sizeVal.classList.add('text-invalid');
                sizeVal.classList.remove('text-orange-600');

                // Math results
                const cubeVol = Math.pow(s, 3);
                mathCubeVol.innerText = cubeVol.toFixed(2) + " cmÂ³";
                mathCubeVol.classList.add('text-invalid');
                mathCubeVol.classList.remove('text-orange-500');

                mathDiffVol.innerText = "ä¸å¯è¡Œ";
                mathPercent.innerText = "N/A";
                mathPercent.className = "font-mono font-bold text-lg text-gray-400"; // Grey out
                mathFormula.innerText = "å°ºå¯¸è¶…å‡ºé•¿æ–¹ä½“é™åˆ¶";
                
                resultBox.className = "flex justify-between items-center bg-red-50 p-2 rounded mt-2 border border-red-100";

            } else {
                // Valid State
                limitWarning.classList.add('hidden');
                
                // Reset colors
                cubeMesh.material.color.setHex(0xf97316); // Orange
                sizeVal.classList.remove('text-invalid');
                sizeVal.classList.add('text-orange-600');
                
                mathCubeVol.classList.remove('text-invalid');
                mathCubeVol.classList.add('text-orange-500');
                
                resultBox.className = "flex justify-between items-center bg-gray-100 p-2 rounded mt-2";
                mathPercent.className = "font-mono font-bold text-green-600 text-lg";

                // 3. Update Valid Math
                const cubeVol = Math.pow(s, 3);
                const diff = totalVol - cubeVol;
                const percent = (diff / totalVol) * 100;

                mathCubeVol.innerText = cubeVol.toFixed(2) + " cmÂ³";
                mathDiffVol.innerText = diff.toFixed(2) + " cmÂ³";
                mathPercent.innerText = percent.toFixed(2) + "%";
                mathFormula.innerText = `(${totalVol} - ${cubeVol.toFixed(2)}) Ã· ${totalVol} â‰ˆ ${(percent/100).toFixed(4)}`;
            }

            // 4. Handle Cut/Transparency Update
            const cutVal = parseInt(cutSlider.value);
            const progress = cutVal / 100;
            progressVal.innerText = cutVal + '%';

            wasteMesh.material.opacity = 0.3 * (1 - progress);
            wireframeTotal.material.opacity = 0.5 * (1 - progress);
        }

        sizeSlider.addEventListener('input', updateScene);
        cutSlider.addEventListener('input', updateScene);

        // --- Animation Loop ---
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Init
        updateScene();
        animate();
        
    })();
    </script>
</body>
</html>
